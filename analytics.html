<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Analytics</title>
    <style>
        :root {
            --bg: #ffffff;
            --text: #000000;
            --positive: #28a745;
            --negative: #dc3545;
            --accent: #007bff;
        }
        body.dark {
            --bg: #121212;
            --text: #e0e0e0;
        }
        body {
            font-family: Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            transition: background 0.3s, color 0.3s;
        }
        h1, h2 { text-align: center; }
        .back-link { text-align: center; margin-bottom: 30px; font-size: 1.1em; }
        .back-link a { color: var(--accent); text-decoration: none; font-weight: bold; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .stat-card {
            background: rgba(0,0,0,0.03);
            border: 1px solid #444;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
        .stat-card.dark { background: rgba(255,255,255,0.05); }
        .stat-value { font-size: 2.8em; font-weight: bold; margin: 10px 0; }
        .positive { color: var(--positive); }
        .negative { color: var(--negative); }
        #no-data { text-align: center; font-size: 1.2em; color: #888; margin: 50px 0; }
    </style>
</head>
<body>

<h1>Trading Analytics</h1>

<div class="back-link">
    <a href="index.html">[← Back to Journal]</a>
</div>

<div id="no-data" style="display:none;">No trades recorded yet. Add some in the journal to see stats here.</div>

<div class="stats-grid" id="statsGrid"></div>

<script>
// Shared data
const trades = JSON.parse(localStorage.getItem('trades')) || [];
const startBalance = parseFloat(localStorage.getItem('startBalance')) || 0;

// Theme sync
function applyTheme() {
    const theme = localStorage.getItem('theme') || 'light';
    document.body.className = theme;
    document.querySelectorAll('.stat-card').forEach(card => {
        card.classList.toggle('dark', theme === 'dark');
    });
}
applyTheme();

// Stats calculation
function calculateStats() {
    if (trades.length === 0) {
        document.getElementById('no-data').style.display = 'block';
        document.getElementById('statsGrid').style.display = 'none';
        return;
    }

    document.getElementById('no-data').style.display = 'none';
    document.getElementById('statsGrid').style.display = 'grid';

    const totalPL = trades.reduce((sum, t) => sum + parseFloat(t.pl || 0), 0);
    const currentBalance = startBalance + totalPL;

    const wins = trades.filter(t => parseFloat(t.pl) > 0).length;
    const winRate = trades.length > 0 ? (wins / trades.length * 100).toFixed(1) : 0;

    const grossProfit = trades.filter(t => parseFloat(t.pl) > 0)
        .reduce((sum, t) => sum + parseFloat(t.pl), 0);
    const grossLoss = Math.abs(trades.filter(t => parseFloat(t.pl) < 0)
        .reduce((sum, t) => sum + parseFloat(t.pl), 0));
    const profitFactor = grossLoss > 0 ? (grossProfit / grossLoss).toFixed(2) : (grossProfit > 0 ? '∞' : '0.00');

    const avgR = trades.length > 0 ? 
        (trades.reduce((sum, t) => sum + parseFloat(t.r || 0), 0) / trades.length).toFixed(2) : '0.00';

    const expectancy = (winRate / 100 * avgR) - (1 - winRate / 100);

    const grid = document.getElementById('statsGrid');
    grid.innerHTML = '';

    const cards = [
        { label: 'Total Trades', value: trades.length, color: '' },
        { label: 'Current Balance', value: `$${currentBalance.toFixed(2)}`, color: totalPL >= 0 ? 'positive' : 'negative' },
        { label: 'Net P/L', value: `${totalPL >= 0 ? '+' : ''}$${totalPL.toFixed(2)}`, color: totalPL >= 0 ? 'positive' : 'negative' },
        { label: 'Win Rate', value: `${winRate}%`, color: '' },
        { label: 'Average R', value: `${avgR}R`, color: '' },
        { label: 'Profit Factor', value: profitFactor, color: '' },
        { label: 'Expectancy', value: `${expectancy.toFixed(2)}R per trade`, color: expectancy >= 0 ? 'positive' : 'negative' }
    ];

    cards.forEach(card => {
        const div = document.createElement('div');
        div.className = 'stat-card';
        div.innerHTML = `
            <h3>${card.label}</h3>
            <div class="stat-value ${card.color}">${card.value}</div>
        `;
        grid.appendChild(div);
    });
}

calculateStats();
</script>

</body>
</html>
